
<div id="bridge-viz" style="width:100%; height:600px; border:1px solid #ccc;"></div>

<script id="bridge-data" type="application/json">
{"nodes": [{"id": "LeftTroll", "label": "LeftTroll"}, {"id": "Real_User", "label": "Real_User"}, {"id": "RightTroll", "label": "RightTroll"}], "links": [{"source": "LeftTroll", "target": "Real_User", "weight": 232}, {"source": "RightTroll", "target": "Real_User", "weight": 56}]}
</script>

<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
  #bridge-viz svg {
    background-color: #f9f9f9;
  }
  .tooltip-bridge {
    position: absolute;
    pointer-events: none;
    padding: 6px 10px;
    background: white;
    border: 1px solid #aaa;
    border-radius: 4px;
    font-size: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
</style>

<script type="text/javascript">
  window.onerror = function(message, source, lineno, colno, error) {
    var v = document.getElementById("bridge-viz");
    v.innerHTML = "<pre style='color:red; white-space:pre-wrap;'>" +
                  "JS error: " + message + "\n" +
                  "Source: " + source + ":" + lineno + ":" + colno +
                  "</pre>";
    return false;
  };

  if (typeof d3 === "undefined") {
    document.getElementById("bridge-viz").innerHTML =
      "<p style='color:red;'>d3 is not defined (failed to load https://d3js.org/d3.v7.min.js)</p>";
  } else {
    const width = document.getElementById("bridge-viz").clientWidth;
    const height = document.getElementById("bridge-viz").clientHeight;

    const svgRoot = d3.select("#bridge-viz").append("svg")
        .attr("width", width)
        .attr("height", height);

    const svg = svgRoot.append("g");

    svgRoot.call(
      d3.zoom()
        .scaleExtent([0.5, 4])
        .on("zoom", (event) => svg.attr("transform", event.transform))
    );

    const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip-bridge")
        .style("opacity", 0);

    const graph = JSON.parse(
      document.getElementById("bridge-data").textContent
    );

    // Example custom colors: adjust to your labels exactly
    function getColor(cat) {
      if (cat.toLowerCase().includes("real")) return "#7FDBFF";   // light blue
      if (cat.toLowerCase().includes("right")) return "#8B0000";  // dark red
      if (cat.toLowerCase().includes("left")) return "#006400";   // dark green
      return "#A9A9A9"; // default gray
    }

    const maxWeight = d3.max(graph.links, d => d.weight) || 1;
    const edgeWidth = d3.scaleLinear()
        .domain([1, maxWeight])
        .range([1, 6]);

    const simulation = d3.forceSimulation(graph.nodes)
        .force("link", d3.forceLink(graph.links).id(d => d.id).distance(150))
        .force("charge", d3.forceManyBody().strength(-500))
        .force("center", d3.forceCenter(width / 2, height / 2));

    const link = svg.append("g")
        .attr("stroke", "#aaa")
        .attr("stroke-opacity", 0.5)
      .selectAll("line")
      .data(graph.links)
      .enter().append("line")
        .attr("stroke-width", d => edgeWidth(d.weight));

    const node = svg.append("g")
      .selectAll("circle")
      .data(graph.nodes)
      .enter().append("circle")
        .attr("r", 18)
        .attr("fill", d => getColor(d.id))
        .attr("stroke", "#fff")
        .attr("stroke-width", 1.5)
        .on("mouseover", function(event, d) {
          tooltip.transition().duration(200).style("opacity", 0.9);
          tooltip
            .html("<b>" + d.label + "</b>")
            .style("left", (event.pageX + 8) + "px")
            .style("top", (event.pageY - 28) + "px");

          link.style("stroke-opacity", function(l) {
            return (l.source.id === d.id || l.target.id === d.id) ? 0.9 : 0.1;
          });
          node.style("opacity", function(n) {
            return (n.id === d.id) ? 1 : 0.3;
          });
        })
        .on("mouseout", function() {
          tooltip.transition().duration(200).style("opacity", 0);
          link.style("stroke-opacity", 0.5);
          node.style("opacity", 1);
        })
        .call(d3.drag()
          .on("start", function(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
          })
          .on("drag", function(event, d) {
            d.fx = event.x;
            d.fy = event.y;
          })
          .on("end", function(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
          }));

    const labels = svg.append("g")
      .selectAll("text")
      .data(graph.nodes)
      .enter().append("text")
        .attr("text-anchor", "middle")
        .attr("dy", 4)
        .style("font-size", "10px")
        .style("pointer-events", "none")
        .text(d => d.label);

    simulation.on("tick", function() {
      link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

      node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);

      labels
        .attr("x", d => d.x)
        .attr("y", d => d.y);
    });
  }
</script>
